# ------------------------------------------------------------------------------------
# Helper to use CPPAST from outside project
#
# CPPAST_FOUND
# CPPAST_INCLUDE_DIRS
# CPPAST_LIBRARY_DIRS
# CPPAST_LIBRARIES
# CPPAST_DEFINITIONS
#------------------------------------------------------------------------------------
#  Usage from an external project:
#    In your CMakeLists.txt, add these lines:
#
#    find_package(cppast REQUIRED)
#    target_link_libraries(MY_TARGET_NAME PUBLIC cppast::_cppast_tiny_process cppast::_cppast_libclang)

@PACKAGE_INIT@

# The C and C++ flags added to the cmake-configured flags.
set(CPPAST_REQUIRED_C_FLAGS "@CPPAST_REQUIRED_C_FLAGS@")
set(CPPAST_REQUIRED_CXX_FLAGS "@CPPAST_REQUIRED_CXX_FLAGS@")

# The version number
set(CPPAST_MAJOR_VERSION "@CPPAST_MAJOR_VERSION@")
set(CPPAST_MINOR_VERSION "@CPPAST_MINOR_VERSION@")
set(CPPAST_PATCH_VERSION "@CPPAST_PATCH_VERSION@")

# Legacy (for backwards compatibility)
set(CPPAST_BUILD_VERSION "${CPPAST_PATCH_VERSION}")

# Configured settings
#set(CPPAST_BUILD_SHARED_LIBS "@BUILD_SHARED_LIBS@")
#set(CPPAST_USE_ITK_GDCM "@USE_ITK_GDCM@")

set_and_check(CPPAST_CMAKE_DIR "@CMAKE_INSTALL_PREFIX@/lib/cmake/@PROJECT_NAME@")

# support cmake default package
include(FindPackageHandleStandardArgs)

# use _cppast_tiny_process
find_package(Threads REQUIRED QUIET)

# Set default policy behavior similar to minimum requirement version
# cmake_policy(VERSION 3.8)

# explicitly set policies we already support in newer cmake versions
if(POLICY CMP0074)
  # TODO: update *_ROOT variables to be CPPAST_*_ROOT or equivalent.
  # CMP0074 directly affects how Find* modules work and *_ROOT variables.  Since
  # this is a config file that will be consumed by parent projects with (likely)
  # NEW behavior, we need to push a policy stack.
  cmake_policy(SET CMP0074 NEW)
endif()

# https://cmake.org/cmake/help/latest/module/CMakePackageConfigHelpers.html

### ---[ Find CPPAST
if (cppast_FIND_QUIETLY) 
  set(QUIET_OR_REQUIRED_OPTION "QUIET")
elseif (cppast_FIND_REQUIRED) 
  set(QUIET_OR_REQUIRED_OPTION "REQUIRED")
else ()
  set(QUIET_OR_REQUIRED_OPTION "")
endif()

# set original package cmake setting
set(CMAKE_MODULE_PATH "${CMAKE_MODULE_PATH} @CPPAST_CMAKE_DIR@")

# Provide all our library targets to users.
# include("${CPPAST_CMAKE_DIR}/module/Finddebug_assert.cmake")
# include("${CPPAST_CMAKE_DIR}/module/Findtype_safe.cmake")

message(STATUS ${CPPAST_ROOT})
# check whether CPPASTConfig.cmake is found into a CPPAST installation or in a build tree
if(EXISTS "${CPPAST_ROOT}/include/cppast_config.h")
  # Found a CPPAST installation
  message(STATUS "Found a CPPAST installation")
  set(CPPAST_CONF_INCLUDE_DIR "${CPPAST_ROOT}/include")
  set(CPPAST_LIBRARY_DIRS "${CPPAST_ROOT}/lib")
  set(CPPAST_LIBRARIES "cppast;_cppast_tiny_process;_cppast_libclang")
  # set(CPPAST_DEFINITIONS
else()
  message(STATUS "CPPAST can not be found on this machine")
endif()

# Get the current directory
message(STATUS ${CMAKE_CURRENT_LIST_FILE})
get_filename_component(CPPAST_CMAKE_DIR "${CMAKE_CURRENT_LIST_FILE}" PATH)

# The location of the "use" file.
#set(CPPAST_USE_FILE "${CPPAST_CMAKE_DIR}/UseCPPAST.cmake")

# Our library dependencies (contains definitions for IMPORTED targets)
if(NOT TARGET Event AND NOT @PROJECT_NAME@_BINARY_DIR)
  include("${CPPAST_CMAKE_DIR}/@PROJECT_NAME@-targets.cmake")
endif()

#set a suffix for debug libraries
set(CPPAST_DEBUG_SUFFIX "@CMAKE_DEBUG_POSTFIX@")
set(CPPAST_RELEASE_SUFFIX "@CMAKE_RELEASE_POSTFIX@")

# Compute paths
set_and_check(CPPAST_INCLUDE_DIRS   "@CMAKE_INSTALL_FULL_INCLUDEDIR@" )
set_and_check(CPPAST_LIBRARY_DIRS   "@CMAKE_INSTALL_PREFIX@/lib")
#set_and_check(CPPAST_ICONS_DIR      "@CMAKE_INSTALL_PREFIX@/share/icons" )
#set_and_check(CPPAST_CONFIG_DIR     "${installedPrefix}/@CONFIG_INSTALL_DIR@" )

# These are IMPORTED targets created by @PROJECT_NAME@-targets.cmake
# set(CPPAST_LIBRARIES      "cppast;_cppast_tiny_process;_cppast_libclang")
set(CPPAST_LIBRARIES      @CPPAST_LIBRARIES@)

#message(STATUS ${CPPAST_LIBRARY_DIRS})
#message(STATUS ${CPPAST_LIBRARIES})
#message(STATUS ${CPPAST_DEBUG_ASSERT_INCLUDE_DIRS})
#message(STATUS ${CPPAST_TYPE_SAFE_INCLUDE_DIRS})

include(${CMAKE_CURRENT_LIST_DIR}/@targets_export_name@.cmake)
check_required_components(cppast)
